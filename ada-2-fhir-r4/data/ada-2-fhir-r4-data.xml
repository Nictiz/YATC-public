<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../sch/ada-2-fhir-r4-data.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<ada-2-fhir-r4-data xmlns="https://nictiz.nl/ns/YATC-public" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="https://nictiz.nl/ns/YATC-public ../xsd/ada-2-fhir-r4-data.xsd">
    <!-- ================================================================== -->
    <!--
        This is the production data for the ada-2-fhir-r4 processing.
        
        Information about the format of this document in its schema ../xsd/ada-2-fhir-r4-data.xsd
        Information about how this file is used in the documentation in the ../doc/ subdirectory.
    -->
    <!-- ================================================================== -->
    <!-- lab -->

    <application name="lab" version="3.0.0" source-adarefs2ada="true" source-project-name="lab">

        <setup usecase="sturen_laboratoriumresultaten" directory-id="labsr">
            <copy-data source-subdir="ada_instance" directory-id="labsr-instance">
                <include glob="*.xml"/>
            </copy-data>
            <copy-project-schemas>
                <include glob="*$USECASE.xsd"/>
            </copy-project-schemas>
            <empty-directory target-subdir="fhir_instance" directory-id="labsr-fhir-instance"/>
            <empty-directory target-subdir="fhir-validation-results" directory-id="labsr-fhir-validation-results" compare="false"/>
        </setup>

        <setup usecase="beschikbaarstellen_laboratoriumresultaten" directory-id="labbr">
            <copy-data source-subdir="ada_instance" directory-id="labbr-instance">
                <include glob="*.xml"/>
            </copy-data>
            <copy-project-schemas>
                <include glob="*$USECASE.xsd"/>
            </copy-project-schemas>
            <empty-directory target-subdir="fhir_instance" directory-id="labbr-fhir-instance"/>
            <empty-directory target-subdir="fhir-validation-results" directory-id="labbr-fhir-validation-results" compare="false"/>
        </setup>

        <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

        <action name="convert" default="true">

            <build name="convert-sturen_laboratoriumresultaten">
                <stylesheet href="../xsl/lab/3.0.0/sturen_laboratoriumresultaten/payload/sturen_laboratoriumresultaten.xsl"/>
                <input-documents directory="@labsr-instance"/>
                <output-documents directory="@labsr-fhir-instance"/>
                <parameter name="writeOutputToDisk" value="false"/>
                <parameter name="dirOutputToDisk" directory="@labsr-fhir-instance"/>
            </build>

            <build name="convert-beschikbaarstellen_laboratoriumresultaten">
                <stylesheet href="../xsl/lab/3.0.0/beschikbaarstellen_laboratoriumresultaten/payload/beschikbaarstellen_laboratoriumresultaten.xsl"/>
                <input-documents directory="@labbr-instance"/>
                <output-documents directory="@labbr-fhir-instance"/>
                <parameter name="writeOutputToDisk" value="true"/>
                <parameter name="dirOutputToDisk" directory="@labbr-fhir-instance"/>
            </build>

        </action>

        <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

        <action name="validate-with-schema">

            <validate-with-schema name="schema-validate-sturen_laboratoriumresultaten">
                <schema href="../xsd/fhir-schemas/fhir-single.xsd"/>
                <input-documents directory="@labsr-fhir-instance"/>
                <output-report directory="@labsr-fhir-validation-results" name="schema-validation-results-sturen_laboratoriumresultaten.xml"/>
            </validate-with-schema>

            <validate-with-schema name="schema-validate-beschikbaarstellen_laboratoriumresultaten">
                <schema href="../xsd/fhir-schemas/fhir-single.xsd"/>
                <input-documents directory="@labbr-fhir-instance"/>
                <output-report directory="@labbr-fhir-validation-results" name="schema-validation-results-beschikbaarstellen_laboratoriumresultaten.xml"/>
            </validate-with-schema>

        </action>

        <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

        <action name="validate-with-schematron">

            <validate-with-schematron name="schematron-validate-sturen_laboratoriumresultaten">
                <schema href="../xsd/fhir-schemas/fhir-invariants.sch"/>
                <input-documents directory="@labsr-fhir-instance"/>
                <output-report directory="@labsr-fhir-validation-results" name="schematron-validation-results-sturen_laboratoriumresultaten.xml"/>
            </validate-with-schematron>

            <validate-with-schematron name="schematron-validate-beschikbaarstellen_laboratoriumresultaten">
                <schema href="../xsd/fhir-schemas/fhir-invariants.sch"/>
                <input-documents directory="@labbr-fhir-instance"/>
                <output-report directory="@labbr-fhir-validation-results" name="schematron-validation-results-beschikbaarstellen_laboratoriumresultaten.xml"/>
            </validate-with-schematron>

        </action>

        <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

        <action name="validate" depends-on="validate-with-schema validate-with-schematron" description="All validation actions"/>

        <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

        <action name="all" depends-on="convert validate" description="Convert and validate"/>

    </application>

    <!-- ======================================================================= -->

    <application name="mp" version="9.2.0" source-adarefs2ada="true" source-project-name="mp-mp92">

        <!-- beschikbaarstellen_medicatiegegevens -->
        <setup usecase="beschikbaarstellen_medicatiegegevens" directory-id="mg">
            <copy-data source-subdir="../raadplegen_medicatiegegevens/ada_instance_response" directory-id="mg-instance">
                <include glob="*.xml"/>
            </copy-data>
            <copy-project-schemas>
                <include glob="*$USECASE.xsd"/>
            </copy-project-schemas>
            <empty-directory target-subdir="fhir_instance" directory-id="mg-fhir-instance"/>
            <empty-directory target-subdir="fhir_instance_medmij" directory-id="mg-fhir-medmij"/>
        </setup>

        <!-- sturen_medicatiegegevens  -->
        <setup usecase="sturen_medicatiegegevens" directory-id="mg.st">
            <copy-data source-subdir="ada_instance" directory-id="mg.st-instance">
                <include glob="mg-*.xml"/>
            </copy-data>
            <copy-data target-subdir="ada_instance_sets" directory-id="mg.st-instance-sets">
                <include glob="mgsets-*.xml"/>
            </copy-data>
            <copy-project-schemas>
                <include glob="*$USECASE.xsd"/>
            </copy-project-schemas>
            <empty-directory target-subdir="fhir_instance" directory-id="mg.st-fhir-instance"/>
            <empty-directory target-subdir="fhir_instance_sets" directory-id="mg.st-fhir-sets"/>
        </setup>

        <!-- sturen_medicatievoorschrift -->
        <setup usecase="sturen_medicatievoorschrift" directory-id="mv">
            <copy-data source-subdir="ada_instance" directory-id="mv-instance">
                <include glob="*.xml"/>
            </copy-data>
            <copy-project-schemas>
                <include glob="*$USECASE.xsd"/>
            </copy-project-schemas>
            <empty-directory target-subdir="fhir_instance" directory-id="mv-fhir-instance"/>
        </setup>


        <!-- sturen_afhandeling_medicatievoorschrift -->
        <setup usecase="sturen_afhandeling_medicatievoorschrift" directory-id="amv">
            <copy-data source-subdir="ada_instance" directory-id="amv-instance">
                <include glob="*.xml"/>
            </copy-data>
            <copy-project-schemas>
                <include glob="*$USECASE.xsd"/>
            </copy-project-schemas>
            <empty-directory target-subdir="fhir_instance" directory-id="amv-fhir-instance"/>
        </setup>

        <!-- sturen_voorstel_medicatieafspraak -->
        <setup usecase="sturen_voorstel_medicatieafspraak" directory-id="vma">
            <copy-data source-subdir="ada_instance" directory-id="vma-instance">
                <include glob="*.xml"/>
            </copy-data>
            <copy-project-schemas>
                <include glob="*$USECASE.xsd"/>
            </copy-project-schemas>
            <empty-directory target-subdir="fhir_instance" directory-id="vma-fhir-instance"/>
        </setup>

        <!-- sturen_antwoord_voorstel_medicatieafspraak -->
        <setup usecase="sturen_antwoord_voorstel_medicatieafspraak" directory-id="avma">
            <copy-data source-subdir="ada_instance" directory-id="avma-instance">
                <include glob="*.xml"/>
            </copy-data>
            <copy-project-schemas>
                <include glob="*$USECASE.xsd"/>
            </copy-project-schemas>
            <empty-directory target-subdir="fhir_instance" directory-id="avma-fhir-instance"/>
        </setup>

        <!-- sturen_voorstel_verstrekkingsverzoek -->
        <setup usecase="sturen_voorstel_verstrekkingsverzoek" directory-id="vvv">
            <copy-data source-subdir="ada_instance" directory-id="vvv-instance">
                <include glob="*.xml"/>
            </copy-data>
            <copy-project-schemas>
                <include glob="*$USECASE.xsd"/>
            </copy-project-schemas>
            <empty-directory target-subdir="fhir_instance" directory-id="vvv-fhir-instance"/>
        </setup>

        <!-- sturen_antwoord_voorstel_verstrekkingsverzoek -->
        <setup usecase="sturen_antwoord_voorstel_verstrekkingsverzoek" directory-id="avvv">
            <copy-data source-subdir="ada_instance" directory-id="avvv-instance">
                <include glob="*.xml"/>
            </copy-data>
            <copy-project-schemas>
                <include glob="*$USECASE.xsd"/>
            </copy-project-schemas>
            <empty-directory target-subdir="fhir_instance" directory-id="avvv-fhir-instance"/>
        </setup>

        <!-- xml-voorbeelden -->
        <setup usecase="xml-voorbeelden" directory-id="xmlv">
            <copy-data source-subdir="ada_instance" directory-id="xmlv-instance">
                <include glob="*.xml"/>
            </copy-data>
        </setup>

        <!-- nictiz_test -->
        <setup usecase="nictiz_test" directory-id="ntest">
            <empty-directory target-subdir="ada_instance" directory-id="ntest-instance"/>
            <empty-directory target-subdir="fhir_instance" directory-id="ntest-fhir-instance"/>
        </setup>

        <setup usecase="4TouchstoneMP" >
            <empty-directory target-subdir="." directory-id="tsmp"/>
        </setup>

        <setup usecase="4TouchstoneMPMedMij" directory-id="tsmpmm">
            <empty-directory target-subdir="."/>
        </setup>

        <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

        <action name="finalize-setup" description="Preprocess for Touchstone beschikbaarstellen_medicatiegegevens">

            <build>
                <stylesheet href="../xsl/mp/9.2.0/fhir_fixtures4Touchstone/payload/preprocess_ada_4_Touchstone.xsl"/>
                <input-documents directory="@mg-instance">
                    <include glob="*Scenarioset0*.xml"/>
                    <include glob="mg-mgrp-999900389-ALL.xml"/>
                </input-documents>
                <output-documents directory="@mg-instance"/>
            </build>

        </action>

        <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

        <action name="convert" default="true" depends-on="finalize-setup">

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <!-- beschikbaarstellen_medicatiegegevens -->

            <!-- resources for Touchstone for beschikbaarstellen_medicatiegegevens -->
            <build name="Resources beschikbaarstellen_medicatiegegevens for Touchstone">
                <stylesheet href="../xsl/mp/9.2.0/fhir_fixtures4Touchstone/payload/beschikbaarstellen_medicatiegegevens_2_fhir_resources.xsl"/>
                <input-documents directory="@mg-instance">
                    <include glob="mg-mp-*.xml"/>
                </input-documents>
                <discard-output/>
                <parameter name="outputDir" directory="@mg-fhir-instance"/>
                <parameter name="generateInstructionText" value="true"/>
                <parameter name="mask-ids" value=""/>
            </build>

            <!--  bundles for beschikbaarstellen_medicatiegegevens -->
            <build name="Bundles beschikbaarstellen_medicatiegegevens">
                <stylesheet href="../xsl/mp/9.2.0/fhir_fixtures4Touchstone/payload/beschikbaarstellen_medicatiegegevens_2_fhir.xsl"/>
                <input-documents directory="@mg-instance">
                    <include glob="*.xml"/>
                </input-documents>
                <discard-output/>
                <parameter name="outputDir" directory="@mg-fhir-instance"/>
                <parameter name="generateInstructionText" value="true"/>
                <parameter name="mask-ids" value=""/>
            </build>

            <build name="Resources beschikbaarstellen_medicatiegegevens for MedMij">
                <stylesheet href="../xsl/mp/9.2.0/fhir_fixtures4Touchstone/payload/beschikbaarstellen_medicatiegegevens_2_fhir_resources.xsl"/>
                <input-documents directory="@mg-instance">
                    <include glob="mg-mp-*.xml"/>
                </input-documents>
                <discard-output/>
                <parameter name="outputDir" directory="@mg-fhir-medmij"/>
                <parameter name="generateInstructionText" value="true"/>
                <parameter name="mask-ids" value="2.16.840.1.113883.2.4.6.3"/>
            </build>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <!-- sturen_medicatiegegevens -->

            <!-- Push bundles for Touchstone for sturen_medicatiegegevens -->
            <build name="Bundles for Touchstone for sturen_medicatiegegevens">
                <stylesheet href="../xsl/mp/9.2.0/fhir_fixtures4Touchstone/payload/sturen_medicatiegegevens_2_fhir.xsl"/>
                <input-documents directory="@mg-instance">
                    <include glob="mg-mp-*.xml"/>
                </input-documents>
                <discard-output/>
                <parameter name="outputDir" directory="@mg.st-fhir-instance"/>
                <parameter name="generateInstructionText" value="true"/>
                <parameter name="mask-ids" value=""/>
            </build>

            <build name="Sets sturen_medicatiegegevens">
                <stylesheet href="../xsl/mp/9.2.0/fhir_fixtures4Touchstone/payload/sturen_medicatiegegevens_2_fhir.xsl"/>
                <input-documents directory="@mg-instance">
                    <include glob="*.xml"/>
                </input-documents>
                <discard-output/>
                <parameter name="outputDir" directory="@mg.st-fhir-sets"/>
                <parameter name="generateInstructionText" value="true"/>
                <parameter name="mask-ids" value=""/>
            </build>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <!-- sturen_medicatievoorschrift -->

            <build name="Bundles sturen_medicatievoorschrift">
                <stylesheet href="../xsl/mp/9.2.0/fhir_fixtures4Touchstone/payload/sturen_medicatievoorschrift_2_fhir.xsl"/>
                <input-documents directory="@mv-instance">
                    <include glob="*.xml"/>
                </input-documents>
                <discard-output/>
                <parameter name="outputDir" directory="@mv-fhir-instance"/>
                <parameter name="generateInstructionText" value="true"/>
                <parameter name="mask-ids" value=""/>
            </build>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <!-- sturen_afhandeling_medicatievoorschrift -->

            <build name="Bundles sturen_afhandeling_medicatievoorschrift">
                <stylesheet href="../xsl/mp/9.2.0/fhir_fixtures4Touchstone/payload/sturen_afhandeling_medicatievoorschrift_2_fhir.xsl"/>
                <input-documents directory="@amv-instance">
                    <include glob="*.xml"/>
                </input-documents>
                <discard-output/>
                <parameter name="outputDir" directory="@amv-fhir-instance"/>
                <parameter name="generateInstructionText" value="true"/>
                <parameter name="mask-ids" value=""/>
            </build>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <!-- sturen_voorstel_medicatieafspraak -->

            <build name="Bundles sturen_voorstel_medicatieafspraak">
                <stylesheet href="../xsl/mp/9.2.0/fhir_fixtures4Touchstone/payload/sturen_voorstel_medicatieafspraak_2_fhir.xsl"/>
                <input-documents directory="@vma-instance">
                    <include glob="*.xml"/>
                </input-documents>
                <discard-output/>
                <parameter name="outputDir" directory="@vma-fhir-instance"/>
                <parameter name="generateInstructionText" value="true"/>
                <parameter name="mask-ids" value=""/>
            </build>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <!-- sturen_antwoord_voorstel_medicatieafspraak -->

            <build name="Bundles sturen_antwoord_voorstel_medicatieafspraak">
                <stylesheet href="../xsl/mp/9.2.0/fhir_fixtures4Touchstone/payload/sturen_antwoord_voorstel_medicatieafspraak_2_fhir.xsl"/>
                <input-documents directory="@avma-instance">
                    <include glob="*.xml"/>
                </input-documents>
                <discard-output/>
                <parameter name="outputDir" directory="@avma-fhir-instance"/>
                <parameter name="generateInstructionText" value="true"/>
                <parameter name="mask-ids" value=""/>
            </build>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <!-- sturen_voorstel_verstrekkingsverzoek -->

            <build name="Bundles sturen_voorstel_verstrekkingsverzoek">
                <stylesheet href="../xsl/mp/9.2.0/fhir_fixtures4Touchstone/payload/sturen_voorstel_verstrekkingsverzoek_2_fhir.xsl"/>
                <input-documents directory="@vvv-instance">
                    <include glob="*.xml"/>
                </input-documents>
                <discard-output/>
                <parameter name="outputDir" directory="@vvv-fhir-instance"/>
                <parameter name="generateInstructionText" value="true"/>
                <parameter name="mask-ids" value=""/>
            </build>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <!-- sturen_antwoord_voorstel_verstrekkingsverzoek -->

            <build name="Bundles sturen_antwoord_voorstel_verstrekkingsverzoek">
                <stylesheet href="../xsl/mp/9.2.0/fhir_fixtures4Touchstone/payload/sturen_antwoord_voorstel_verstrekkingsverzoek_2_fhir.xsl"/>
                <input-documents directory="@avvv-instance">
                    <include glob="*.xml"/>
                </input-documents>
                <discard-output/>
                <parameter name="outputDir" directory="@avvv-fhir-instance"/>
                <parameter name="generateInstructionText" value="true"/>
                <parameter name="mask-ids" value=""/>
            </build>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <!-- nictiz_test -->

            <copy>
                <source directory="#mp/9.2.0/nictiz_test/ada_instance/">
                    <include glob="*.xml"/>
                </source>
                <target directory="@ntest-instance"/>
            </copy>

            <build name="Bundles beschikbaarstellen_medicatiegegevens">
                <stylesheet href="../xsl/mp/9.2.0/fhir_fixtures4Touchstone/payload/beschikbaarstellen_medicatiegegevens_2_fhir.xsl"/>
                <input-documents directory="@ntest-instance">
                    <include glob="*.xml"/>
                </input-documents>
                <discard-output/>
                <parameter name="outputDir" directory="@ntest-fhir-instance"/>
                <parameter name="generateInstructionText" value="true"/>
                <parameter name="mask-ids" value=""/>
            </build>

            <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
            <!-- Additional copying: -->

            <!-- Copy the appropriate fhir instances for Touchstone to a separate folder, to ease upload to Touchstone -->
            <copy>
                <source directory="@mg-fhir-instance">
                    <include glob="*.xml"/>
                    <!-- the resources and scenarioset bundles are needed on Touchstone / WildFHIR, exclude the ALL bundles -->
                    <exclude glob="mg-*ALL.xml"/>
                </source>
                <target directory="@tsmp"/>
            </copy>
            <copy>
                <source directory="@mg.st-fhir-sets">
                    <include glob="*.xml"/>
                </source>
                <target directory="@tsmp"/>
            </copy>
            <copy>
                <source directory="@mv-fhir-instance">
                    <include glob="*.xml"/>
                </source>
                <target directory="@tsmp"/>
            </copy>
            <copy>
                <source directory="@amv-fhir-instance">
                    <include glob="*.xml"/>
                </source>
                <target directory="@tsmp"/>
            </copy>
            <copy>
                <source directory="@vma-fhir-instance">
                    <include glob="*.xml"/>
                </source>
                <target directory="@tsmp"/>
            </copy>
            <copy>
                <source directory="@avma-fhir-instance">
                    <include glob="*.xml"/>
                </source>
                <target directory="@tsmp"/>
            </copy>
            <copy>
                <source directory="@vvv-fhir-instance">
                    <include glob="*.xml"/>
                </source>
                <target directory="@tsmp"/>
            </copy>
            <copy>
                <source directory="@avvv-fhir-instance">
                    <include glob="*.xml"/>
                </source>
                <target directory="@tsmp"/>
            </copy>

            <!-- copy the appropriate fhir instances for Touchstone MedMij to a separate folder, to ease upload to Touchstone -->
            <copy>
                <source directory="@mg-fhir-medmij">
                    <include glob="*.xml"/>
                    <!-- the resources and scenarioset bundles are needed on Touchstone / WildFHIR, exclude the ALL bundles -->
                    <exclude glob="mg-*ALL.xml"/>
                </source>
                <target directory="@tsmpmm"/>
            </copy>

        </action>

    </application>

</ada-2-fhir-r4-data>
